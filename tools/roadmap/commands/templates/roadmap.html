{{- /*gotype: github.com/SierraSoftworks/roadmap.Roadmap*/ -}}
{{ $root := . -}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }}</title>
    <style>
        {{ stylesheet }}
    </style>
    <script lang="javascript">
        {{ script }}
    </script>
</head>
<body>
    <section role="document">
        <section role="doc-introduction">
            <h1 class="roadmap-title">{{ .Title }}</h1>

            <div class="authors">
                <div class="authors_title">Authored by</div>

                {{ range .Authors }}
                <div class="author">
                    <h5>{{ .Name }}</h5>
                    <p>{{ .Contact }}</p>
                </div>
                {{ end }}
            </div>
            
            {{ .Description | markdown }}
        </section>

        <section role="doc-notice">
            <h2 class="section-title">Important Dates</h2>

            <div class="timeline">
                {{ range .Timeline }}
                <div class="timeline-item" data-date="{{ .Date.Format "2006-01-02" }}">
                    <h3 class="timeline-item__title">{{ .Title }}</h3>
                    <div class="timeline-item__description">{{ .Description | markdown }}</div>
                </div>
                {{ end }}
            </div>
        </section>
        
        <section role="main">
            <h2 class="section-title">Objectives</h2>
            {{ range .Objectives }}
            <h3 class="section-subtitle">{{ .Title }}</h3>
            {{ .Description | markdown }}
            {{ end }}

            <h2 class="section-title">Milestones</h2>

            <div class="timeline">
                {{ range $i, $m := .Milestones }}
                <div id="milestone-{{ $m.ID }}" class="timeline-item" data-date="M{{ add $i 1 }}">
                    <h3 class="timeline-item__title section-subtitle">{{ $m.Title }}</h3>
                    <div class="timeline-item_description">
                        {{ .Description | markdown }}

                        {{ with $m.Reference }}
                        <a class="card-link" href="{{ . }}">Read more &rarr;</a>
                        {{ end }}
                    
                        {{ if and (param "collapsed") ($m.Deliverables) }}
                        {{- $done := countByState $m.Deliverables "DONE" -}}
                        {{- $doing := countByState $m.Deliverables "DOING" -}}
                        {{- $skip := countByState $m.Deliverables "SKIP" -}}
                        {{- $todo := sub (len $m.Deliverables) (add (add $done $doing) $skip) -}}
                        <details class="deliverables-collapse">
                        <summary class="deliverables-summary">{{ len $m.Deliverables }} deliverable{{ if ne (len $m.Deliverables) 1 }}s{{ end }} -{{ if gt $done 0 }} <span class="state-done">{{ $done }} done</span>{{ if or (gt $doing 0) (gt $todo 0) (gt $skip 0) }},{{ end }}{{ end }}{{ if gt $doing 0 }} <span class="state-doing">{{ $doing }} in progress</span>{{ if or (gt $todo 0) (gt $skip 0) }},{{ end }}{{ end }}{{ if gt $todo 0 }} <span class="state-todo">{{ $todo }} to do</span>{{ if gt $skip 0 }},{{ end }}{{ end }}{{ if gt $skip 0 }} <span class="state-skip">{{ $skip }} skipped</span>{{ end }}</summary>
                        {{ range $m.Deliverables }}
                        <div id="milestone-{{ $m.ID }}-deliverable-{{ .ID }}" class="card card-{{ .State }}">
                            <h4 class="card-title">
                                <p class="card-state">{{ .State }}</p>
                                {{ .Title }}
                                {{ with .Requirement }}<span class="tablet tablet-{{ . }}">{{ . }}</span>{{ end }}
                            </h4>
                            {{ .Description | markdown }}

                            {{ with .Reference }}
                            <a class="card-link" href="{{ . }}">Read more &rarr;</a>
                            {{ end }}
                        </div>
                        {{ end }}
                        </details>
                        {{ else }}
                        {{ range $m.Deliverables }}
                        <div id="milestone-{{ $m.ID }}-deliverable-{{ .ID }}" class="card card-{{ .State }}">
                            <h4 class="card-title">
                                <p class="card-state">{{ .State }}</p>
                                {{ .Title }}
                                {{ with .Requirement }}<span class="tablet tablet-{{ . }}">{{ . }}</span>{{ end }}
                            </h4>
                            {{ .Description | markdown }}

                            {{ with .Reference }}
                            <a class="card-link" href="{{ . }}">Read more &rarr;</a>
                            {{ end }}
                        </div>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </section>
    </section>
    
</body>
</html>